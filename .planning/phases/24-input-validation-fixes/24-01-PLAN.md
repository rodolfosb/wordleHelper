---
phase: 24-input-validation-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/logic/constraints.ts, src/main.ts, src/ui/GuessGrid.ts]
autonomous: true
---

<objective>
Fix input validation bugs: enforce hard mode constraints on guess submission and prevent editing submitted rows.

Purpose: Ensure game rules are properly enforced for a correct Wordle experience.
Output: Working hard mode validation with error messages, and row locking after submission.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/logic/constraints.ts
@src/logic/filter.ts
@src/ui/GuessGrid.ts
@src/main.ts
@src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add satisfiesConstraints function to constraints.ts</name>
  <files>src/logic/constraints.ts</files>
  <action>
Add a new function `satisfiesConstraints(word: string, constraints: Constraints): boolean` that checks if a guess word satisfies all accumulated constraints from previous guesses.

The function should check:
1. Green letters: word must have the exact letter at each exactPosition
2. Yellow letters: word must contain each requiredLetter somewhere (not at excluded positions)
3. Gray letters: word must not contain excludedLetters (unless in requiredLetters for duplicate handling)

This is similar to filterWords logic but for a single word validation. Export the function.
  </action>
  <verify>TypeScript compiles: `npm run build` succeeds</verify>
  <done>satisfiesConstraints function exported from constraints.ts</done>
</task>

<task type="auto">
  <name>Task 2: Add hard mode validation to guess submission</name>
  <files>src/main.ts</files>
  <action>
In the `guessGrid.onSubmit()` callback (around line 418), after validating the word exists in the word list, add hard mode validation:

1. Import `satisfiesConstraints` from './logic/constraints'
2. Before clearing the error message (line 433), if `hardModeEnabled` is true:
   - Build constraints from all completed rows using `getAllFeedback()` and `addGuessToConstraints()`
   - Call `satisfiesConstraints(word, constraints)`
   - If it returns false:
     - Call `guessGrid.shakeRow(row)`
     - Call `showGameMessage('Hard mode: must use revealed hints', 'error')`
     - Return early (don't submit the guess)

Remove the unused `void hardModeEnabled;` line (around line 393) since we're now using it.
  </action>
  <verify>
Manual test:
1. Enable hard mode in settings
2. Make a guess that reveals a green letter (e.g., first letter is 'S')
3. Try submitting a word that doesn't start with 'S'
4. Should see shake animation and error message "Hard mode: must use revealed hints"
  </verify>
  <done>Hard mode validation enforced on guess submission with appropriate error message</done>
</task>

<task type="auto">
  <name>Task 3: Prevent editing submitted rows via backspace</name>
  <files>src/ui/GuessGrid.ts</files>
  <action>
Add a mechanism to track which rows have been submitted and prevent backspace from editing them:

1. Add a private field `submittedRows: Set<number> = new Set()` to track rows that have been submitted
2. In `deleteLetter()` method (around line 250), modify the logic that allows moving to previous row:
   - Change the condition `if (this.currentCol === 0 && this.currentRow > 0)` to also check:
   - Only allow moving back if the previous row (currentRow - 1) is NOT in submittedRows
   - Specifically: `if (this.currentCol === 0 && this.currentRow > 0 && !this.submittedRows.has(this.currentRow - 1))`
3. Add a public method `markRowSubmitted(row: number): void` that adds a row to submittedRows
4. In `reset()` method, clear the submittedRows set: `this.submittedRows.clear()`
5. In `setWordLength()` method, also clear submittedRows when rebuilding grid
  </action>
  <verify>TypeScript compiles: `npm run build` succeeds</verify>
  <done>GuessGrid tracks submitted rows and prevents backspace into them</done>
</task>

<task type="auto">
  <name>Task 4: Call markRowSubmitted after successful guess</name>
  <files>src/main.ts</files>
  <action>
In the `guessGrid.onSubmit()` callback, after a guess passes all validation and colors are set:

1. After `guessGrid.setRowColors(row, colors)` (around line 441), call `guessGrid.markRowSubmitted(row)` to lock that row from editing

This should be called immediately after setRowColors, before the setTimeout for animation.
  </action>
  <verify>
Manual test:
1. Make a valid guess
2. After colors reveal, try pressing backspace multiple times
3. Should NOT be able to delete letters from the submitted row
4. Can only delete letters from the current (new) row
  </verify>
  <done>Submitted rows are marked and protected from backspace editing</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Hard mode validation: submitting a word that doesn't use revealed hints shows error
- [ ] Row locking: backspace cannot edit previously submitted rows
- [ ] Normal gameplay still works (non-hard mode, valid guesses accepted)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Hard mode properly enforces using revealed hints
- Submitted rows are locked from editing
</success_criteria>

<output>
After completion, create `.planning/phases/24-input-validation-fixes/24-01-SUMMARY.md`
</output>
