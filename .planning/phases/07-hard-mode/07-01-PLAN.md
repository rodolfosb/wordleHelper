---
phase: 07-hard-mode
plan: 01
type: execute
depends_on: []
files_modified: [src/logic/hardMode.ts, src/main.ts, src/style.css]
---

<objective>
Implement Wordle hard mode that filters suggestions to only show words that would be valid hard-mode guesses.

Purpose: In official Wordle hard mode, players must reuse green letters in correct positions and include yellow letters somewhere in subsequent guesses. This feature filters suggestions to only show hard-mode-valid options.

Output: Hard mode toggle in UI, filtering logic, integrated into suggestion display.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-core-logic/02-01-SUMMARY.md

**Key files:**
@src/logic/constraints.ts
@src/logic/filter.ts
@src/main.ts
@src/types/index.ts
@src/style.css

**Codebase patterns to follow:**
- Logic modules in src/logic/ directory
- Immutable constraint updates
- Filter functions take word list and constraints, return filtered list
- Controls in .controls div with consistent button/toggle styling
- Real-time filtering via onChange callback

**Hard Mode Rules (official Wordle):**
1. Green letters: Must use the same letter in the exact same position
2. Yellow letters: Must use the letter somewhere in the word
3. Applies cumulatively to ALL previous guesses

**Implementation notes:**
- Hard mode filter is ADDITIONAL to regular constraint filtering
- Regular filter: "what words COULD be the answer?"
- Hard mode filter: "what words are VALID GUESSES under hard mode rules?"
- Both use the same Constraints object but ask different questions
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create hard mode filter function</name>
  <files>src/logic/hardMode.ts</files>
  <action>
Create isHardModeValid(word: string, constraints: Constraints): boolean function.

Rules to check:
1. For each exactPositions entry: word[position] must equal the required letter
2. For each requiredLetters entry: word must contain the letter

Note: excludedLetters are NOT relevant for hard mode - those constrain the ANSWER, not valid GUESSES.

The function checks if a candidate GUESS satisfies hard mode rules given accumulated constraints.
  </action>
  <verify>Create quick test in main.ts:
- constraints with exactPositions: {0: 's'}, requiredLetters: {a: [1]}
- isHardModeValid('stare', constraints) === true (has 's' at 0, has 'a')
- isHardModeValid('brick', constraints) === false (no 's' at 0, no 'a')
  </verify>
  <done>Function correctly identifies valid/invalid hard mode guesses</done>
</task>

<task type="auto">
  <name>Task 2: Add hard mode toggle UI and integrate filter</name>
  <files>src/main.ts, src/style.css</files>
  <action>
1. Add toggle switch to controls div next to New Game button:
   - Label: "Hard Mode"
   - Use checkbox with custom toggle styling (slider style, Wordle green when active)
   - Store state in local variable `hardModeEnabled: boolean = false`

2. In updateSuggestions():
   - After filterWords, if hardModeEnabled, additionally filter with:
     `filteredWords = filteredWords.filter(w => isHardModeValid(w, constraints))`
   - This ensures suggestions only show hard-mode-valid words

3. Toggle onChange: call updateSuggestions() to refresh suggestions

4. In resetGame(): reset hardModeEnabled to false, uncheck toggle

CSS for toggle:
- .hard-mode-toggle container with label + input[type=checkbox] + slider span
- Use #538d4e (Wordle green) for active state
- Match .new-game-btn vertical alignment
  </action>
  <verify>
1. Toggle appears in controls, visually aligned with New Game button
2. When off: full word list shown (same as before)
3. When on: suggestions filtered to hard-mode-valid words only
4. After entering guess with green/yellow letters, hard mode suggestions respect those constraints
5. New Game resets toggle to off
  </verify>
  <done>
- Hard mode toggle visible and functional
- Suggestions correctly filtered when hard mode enabled
- New Game resets hard mode state
  </done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] No TypeScript errors
- [ ] Hard mode toggle renders correctly
- [ ] With hard mode OFF: behavior unchanged from before
- [ ] With hard mode ON: only hard-mode-valid suggestions shown
- [ ] Manual test: Enter "CRANE" with C=gray, R=yellow, A=green, N=gray, E=yellow
  - Hard mode ON should only show words with: A at position 2, R somewhere, E somewhere
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Hard mode correctly filters suggestions based on accumulated constraints
- UI toggle integrates seamlessly with existing controls
- No regressions to existing functionality
  </success_criteria>

<output>
After completion, create `.planning/phases/07-hard-mode/07-01-SUMMARY.md`
</output>
