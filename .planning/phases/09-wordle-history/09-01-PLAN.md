---
phase: 09-wordle-history
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/index.ts
  - src/data/history.ts
  - src/ui/HistoryPicker.ts
  - src/main.ts
  - src/style.css
autonomous: true
---

<objective>
Add historical Wordle puzzle integration, allowing users to practice with past puzzles by selecting a date.

Purpose: Enable practice mode where users can solve any past Wordle puzzle from the archive (~1700+ puzzles since June 2021).
Output: Date picker UI, historical data fetch with caching, practice mode integration.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-wordle-history/09-RESEARCH.md

# Prior phase context (stats modal pattern, LocalStorage pattern)
@.planning/phases/08-session-stats/08-01-SUMMARY.md

# Relevant source files
@src/types/index.ts
@src/main.ts
@src/style.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create history types and data module</name>
  <files>src/types/index.ts, src/data/history.ts</files>
  <action>
1. Add to src/types/index.ts:
   ```typescript
   export interface HistoricalPuzzle {
     game: number;      // Puzzle number (1 = first official)
     date: string;      // "YYYY-MM-DD" format
     answer: string;    // lowercase 5-letter word
   }
   ```

2. Create src/data/history.ts with:
   - CACHE_KEY = 'wordle-history-cache'
   - CACHE_TTL = 24 * 60 * 60 * 1000 (24 hours)
   - WORDLE_START_DATE = '2021-06-19' (first official puzzle)
   - Interface CachedHistory { puzzle: HistoricalPuzzle | null; fetchedAt: number; }

3. Implement getPuzzleByDate(date: string): Promise<HistoricalPuzzle | null>
   - First check localStorage cache for this specific date
   - If cached and fresh (< 24h), return cached data
   - Otherwise fetch from NYT API: https://www.nytimes.com/svc/wordle/v2/{date}.json
   - If NYT fails (CORS or network), try WordleHints fallback: https://wordlehints.co.uk/wp-json/wordlehint/v1/answers?date={date}
   - Normalize answer to lowercase
   - Cache result in localStorage (key per date: `wordle-history-{date}`)
   - Return null if both APIs fail

4. Implement getMaxDate(): string - returns yesterday's date (avoid today's spoiler)

5. Implement getMinDate(): string - returns WORDLE_START_DATE

Important: Use try/catch around fetch calls. Handle network errors gracefully. If response.ok is false, try fallback API. Normalize case immediately (NYT returns lowercase, WordleHints returns UPPERCASE).
  </action>
  <verify>
- TypeScript compiles: npm run build
- history.ts exports getPuzzleByDate, getMaxDate, getMinDate
  </verify>
  <done>
- HistoricalPuzzle type exported from types
- history.ts module fetches and caches puzzle data
- Fallback to WordleHints if NYT fails
  </done>
</task>

<task type="auto">
  <name>Task 2: Create HistoryPicker UI component</name>
  <files>src/ui/HistoryPicker.ts, src/style.css</files>
  <action>
1. Create src/ui/HistoryPicker.ts with:
   ```typescript
   import { getMinDate, getMaxDate, getPuzzleByDate } from '../data/history';
   import { HistoricalPuzzle } from '../types';

   export class HistoryPicker {
     private container: HTMLElement;
     private dateInput: HTMLInputElement;
     private loadButton: HTMLButtonElement;
     private statusEl: HTMLElement;
     private onPuzzleSelected: (puzzle: HistoricalPuzzle) => void;

     constructor(
       containerId: string,
       onPuzzleSelected: (puzzle: HistoricalPuzzle) => void
     )

     render(): void
     show(): void
     hide(): void
     private async loadPuzzle(): Promise<void>
   }
   ```

2. render() creates:
   - Container div with class "history-picker"
   - Label: "Practice with a past puzzle:"
   - Native date input (<input type="date">) with:
     - min = getMinDate() (2021-06-19)
     - max = getMaxDate() (yesterday)
     - Default value = max (yesterday)
   - Load button: "Load Puzzle"
   - Status element for loading/error messages
   - Close/cancel button to exit practice mode

3. loadPuzzle():
   - Show "Loading..." status
   - Call getPuzzleByDate(dateInput.value)
   - If null, show error: "Puzzle not found for this date"
   - If success, call onPuzzleSelected(puzzle) and update status with puzzle number

4. Add CSS to src/style.css:
   - .history-picker container (modal-like styling matching StatsModal)
   - .history-picker input[type="date"] (dark theme, matches app)
   - .history-picker button (matches existing button styles)
   - .history-picker .status (for loading/error text)
   - Show/hide with display: none/block
  </action>
  <verify>
- npm run build succeeds
- HistoryPicker class exported with render(), show(), hide()
  </verify>
  <done>
- HistoryPicker component renders date input and load button
- CSS styles match app theme
- Loading and error states handled
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate practice mode into main app</name>
  <files>src/main.ts, src/style.css</files>
  <action>
1. Add "Practice" button to header (next to Stats button):
   - Icon: calendar or clock SVG (simple, matches existing icons)
   - Click shows HistoryPicker

2. Add practice mode state:
   - let practiceMode: boolean = false
   - let currentPuzzle: HistoricalPuzzle | null = null

3. Create startPracticeMode(puzzle: HistoricalPuzzle):
   - Set practiceMode = true, currentPuzzle = puzzle
   - Reset game state (clear guesses, reset constraints)
   - Show puzzle info: "Practice: Wordle #{puzzle.game} ({puzzle.date})"
   - Hide HistoryPicker

4. Modify win/loss handling:
   - If practiceMode, show the answer in result message
   - If practiceMode, do NOT update session stats (practice doesn't count)
   - Add "Exit Practice" button to return to normal mode

5. Create exitPracticeMode():
   - Set practiceMode = false, currentPuzzle = null
   - Clear practice indicator
   - Reset game for normal play

6. Add practice indicator element:
   - Shown only during practice mode
   - Displays "Practice Mode: Wordle #{game}"
   - Styled distinctly (maybe subtle background change or banner)

7. Add CSS:
   - Practice button in header
   - Practice mode indicator styling
   - Exit practice button
  </action>
  <verify>
- npm run build succeeds
- npm run dev shows Practice button in header
- Click Practice opens date picker
- Selecting date loads puzzle
- Win/loss shows answer for practice games
- Exit returns to normal mode
  </verify>
  <done>
- Practice button in header opens date picker
- Practice mode shows puzzle info and doesn't affect stats
- Exit practice returns to normal mode
- Full flow works: select date → load → play → see answer → exit
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds without errors
- [ ] npm run dev starts without errors
- [ ] Practice button visible in header
- [ ] Date picker opens with valid date range (2021-06-19 to yesterday)
- [ ] Loading a past puzzle works (may need to test both APIs if CORS issues)
- [ ] Practice mode indicator shows during practice
- [ ] Solving practice puzzle shows answer
- [ ] Stats are NOT updated for practice games
- [ ] Exit practice returns to normal mode
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript or build errors
- Practice mode is distinct from regular play
- Historical puzzles can be loaded and played
- Stats remain untouched during practice
</success_criteria>

<output>
After completion, create `.planning/phases/09-wordle-history/09-01-SUMMARY.md`
</output>
