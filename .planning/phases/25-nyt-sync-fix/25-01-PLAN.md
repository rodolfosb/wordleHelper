---
phase: 25-nyt-sync-fix
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/utils/nytApi.ts
  - src/data/history.ts
  - src/data/wordleAnswers.json
autonomous: true
---

<objective>
Fix NYT puzzle date sync issue causing wrong puzzle to display

Purpose: Ensure users always see the correct day's puzzle regardless of their timezone or when they load the app
Output: Consistent date handling across all date-related functions, updated embedded data
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/utils/nytApi.ts
@src/data/history.ts
@src/data/wordleAnswers.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix timezone inconsistency in date handling</name>
  <files>src/utils/nytApi.ts, src/data/history.ts</files>
  <action>
The issue: `toISOString().split('T')[0]` converts to UTC before extracting the date, which can return the previous day's date for users in timezones behind UTC (e.g., US timezones at 11 PM local = early next day UTC).

Fix both files to use consistent LOCAL date extraction:

1. In `src/data/history.ts`:
   - `getMaxDate()` line 63-64: Change from `today.toISOString().split('T')[0]` to local date formatting
   - `getTodaysPuzzle()` line 86-87: Change from `toISOString().split('T')[0]` to local date formatting

2. Create a shared date formatting utility (or inline the same logic in both files):
   ```typescript
   function formatLocalDate(date: Date): string {
     const year = date.getFullYear();
     const month = String(date.getMonth() + 1).padStart(2, '0');
     const day = String(date.getDate()).padStart(2, '0');
     return `${year}-${month}-${day}`;
   }
   ```

3. In `src/utils/nytApi.ts`, the `formatDate` function already uses local time correctly - no changes needed.

4. Verify: After changes, both files should produce the same date string for "today" regardless of timezone:
   - `nytApi.ts`: `formatDate(new Date())` → local YYYY-MM-DD
   - `history.ts`: `formatLocalDate(new Date())` → local YYYY-MM-DD (same as above)

Why local time: NYT Wordle publishes at midnight Eastern Time, but users expect their local "day" to match. Since the NYT API endpoint uses the date string to look up puzzles, and we want users to play "today's puzzle" from their perspective, local time is correct.
  </action>
  <verify>
    - `npm run build` succeeds
    - No TypeScript errors
    - Manually verify: In browser console, `new Date().toISOString().split('T')[0]` vs the new local formatting should show the same date during daytime hours
  </verify>
  <done>Both files use consistent local date formatting. Date strings match between nytApi.ts and history.ts.</done>
</task>

<task type="auto">
  <name>Task 2: Update embedded puzzle data to current date</name>
  <files>src/data/wordleAnswers.json</files>
  <action>
The embedded data currently ends at 2026-01-19 (game #1675). Today is 2026-01-21.

1. Fetch the missing puzzle data from NYT API for 2026-01-20 and 2026-01-21:
   ```bash
   curl -s "https://www.nytimes.com/svc/wordle/v2/2026-01-20.json" | jq '{game: .days_since_launch, date: .print_date, answer: .solution}'
   curl -s "https://www.nytimes.com/svc/wordle/v2/2026-01-21.json" | jq '{game: .days_since_launch, date: .print_date, answer: .solution}'
   ```

2. Add the new entries to the end of wordleAnswers.json, maintaining the format:
   ```json
   {
     "game": 1676,
     "date": "2026-01-20",
     "answer": "XXXXX"
   },
   {
     "game": 1677,
     "date": "2026-01-21",
     "answer": "XXXXX"
   }
   ```
   (Replace XXXXX with actual answers from API response, lowercase)

3. Ensure the JSON array is properly terminated (no trailing comma on last entry).

Note: The NYT API is the primary source for today's puzzle. The embedded data is a fallback. Keeping it updated reduces reliance on external API and improves offline experience.
  </action>
  <verify>
    - JSON is valid: `cat src/data/wordleAnswers.json | jq . > /dev/null && echo "Valid JSON"`
    - Last entry is today's date: `tail -10 src/data/wordleAnswers.json`
    - `npm run build` succeeds
  </verify>
  <done>Embedded data includes puzzles up to today (2026-01-21).</done>
</task>

<task type="auto">
  <name>Task 3: Test the fix end-to-end</name>
  <files>-</files>
  <action>
1. Run the dev server: `npm run dev`

2. Test in browser:
   - Open the app
   - Check the puzzle info displays today's date (should show "Wordle #XXXX (Jan 21, 2026)" or similar)
   - The puzzle should be today's puzzle, not an old one
   - Check browser console for any errors or warnings about NYT API fallback

3. Test the fallback:
   - Open DevTools Network tab
   - Block requests to `nytimes.com/svc/wordle`
   - Refresh the page
   - The app should fall back to embedded data and still show today's puzzle (since we updated the data)
   - Should NOT show the "puzzle data out of date" warning

4. Test different scenarios:
   - Clear localStorage to remove cache: `localStorage.removeItem('wordle-nyt-cache')`
   - Refresh - should fetch from API and work correctly
  </action>
  <verify>
    - Dev server starts without errors
    - Puzzle info shows today's date
    - No "out of date" warning displayed
    - Console shows no errors related to date/puzzle fetching
  </verify>
  <done>App displays correct puzzle for today's date. Fallback works with updated embedded data.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] No TypeScript errors
- [ ] App displays correct puzzle for today's date in NYT mode
- [ ] Embedded data is up to date through today
- [ ] No "puzzle data out of date" warning shown
</verification>

<success_criteria>

- All tasks completed
- Timezone handling is consistent across all date functions
- Embedded puzzle data is current
- App correctly displays today's puzzle
- No errors or warnings in console
</success_criteria>

<output>
After completion, create `.planning/phases/25-nyt-sync-fix/25-01-SUMMARY.md`
</output>
