---
phase: 11-game-mode
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/logic/gameLogic.ts, src/ui/GuessGrid.ts, src/main.ts, src/data/history.ts, src/style.css]
autonomous: true
---

<objective>
Convert app from helper tool to actual Wordle game with auto-revealing letter colors.

Purpose: Transform the app into a playable Wordle game where users enter guesses and the app reveals correct green/yellow/gray colors based on the day's answer.
Output: Working game mode for both today's puzzle and practice mode with historical puzzles.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/main.ts
@src/ui/GuessGrid.ts
@src/data/history.ts
@src/data/wordleAnswers.ts
@src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create game logic module for color calculation</name>
  <files>src/logic/gameLogic.ts, src/types/index.ts</files>
  <action>
Create a new module that calculates the correct letter colors based on Wordle's algorithm:

1. Create `src/logic/gameLogic.ts`:
   ```typescript
   import type { LetterStatus } from '../types';

   /**
    * Calculate letter statuses for a guess against the answer.
    * Implements Wordle's exact algorithm:
    * 1. Mark all exact matches (green) first
    * 2. For remaining letters, mark as yellow if letter exists in answer
    *    (but only as many times as it appears in answer minus greens)
    * 3. Everything else is gray
    */
   export function calculateLetterStatuses(
     guess: string,
     answer: string
   ): LetterStatus[] {
     const result: LetterStatus[] = ['gray', 'gray', 'gray', 'gray', 'gray'];
     const answerChars = answer.toLowerCase().split('');
     const guessChars = guess.toLowerCase().split('');
     const answerCharCounts: Record<string, number> = {};

     // Count available letters in answer
     for (const char of answerChars) {
       answerCharCounts[char] = (answerCharCounts[char] || 0) + 1;
     }

     // First pass: mark greens (exact position matches)
     for (let i = 0; i < 5; i++) {
       if (guessChars[i] === answerChars[i]) {
         result[i] = 'green';
         answerCharCounts[guessChars[i]]--;
       }
     }

     // Second pass: mark yellows (letter exists but wrong position)
     for (let i = 0; i < 5; i++) {
       if (result[i] === 'green') continue; // Already matched
       const char = guessChars[i];
       if (answerCharCounts[char] && answerCharCounts[char] > 0) {
         result[i] = 'yellow';
         answerCharCounts[char]--;
       }
       // Otherwise stays gray
     }

     return result;
   }
   ```

2. Add tests in comments or verify manually with known examples:
   - guess="crane", answer="slate" → [gray, gray, yellow, gray, green]
   - guess="speed", answer="abide" → [gray, gray, yellow, yellow, gray] (handles duplicate letters)
   - guess="allay", answer="natal" → [yellow, gray, yellow, green, gray] (handles multiple same letters)

Avoid: Over-engineering. This is a pure function with no side effects.
  </action>
  <verify>
    - npm run build succeeds
    - Manual testing: calculateLetterStatuses('crane', 'slate') returns expected colors
    - Handles duplicate letters correctly (e.g., 'speed' vs 'abide')
  </verify>
  <done>Game logic correctly calculates Wordle color statuses for any guess/answer pair</done>
</task>

<task type="auto">
  <name>Task 2: Update GuessGrid for game mode (auto-color reveal)</name>
  <files>src/ui/GuessGrid.ts, src/style.css</files>
  <action>
Modify GuessGrid to support game mode where colors are set programmatically:

1. Add method to set colors for a row:
   ```typescript
   /**
    * Set colors for a completed row (used in game mode)
    * @param row - Row index
    * @param colors - Array of 5 LetterStatus values
    */
   public setRowColors(row: number, colors: LetterStatus[]): void {
     if (row < 0 || row >= 6) return;
     if (colors.length !== 5) return;

     for (let col = 0; col < 5; col++) {
       this.colors[row][col] = colors[col];
       this.updateCell(row, col);
     }
   }
   ```

2. Add game mode flag to disable manual color cycling:
   ```typescript
   private gameMode: boolean = false;

   public setGameMode(enabled: boolean): void {
     this.gameMode = enabled;
   }
   ```

3. Update handleCellClick to respect game mode:
   ```typescript
   private handleCellClick(row: number, col: number): void {
     if (this.inputLocked) return;
     if (this.gameMode) return; // No manual color cycling in game mode
     // ... rest of existing logic
   }
   ```

4. Add flip animation for revealing colors (optional enhancement):
   - When setRowColors is called, add a staggered flip animation to each cell
   - Use CSS: transform: rotateX(90deg) then back to 0
   - Stagger: 100ms delay per cell (0, 100, 200, 300, 400ms)
   - Add .cell-flip class with animation

5. Add CSS for flip animation in style.css:
   ```css
   @keyframes cell-flip {
     0% { transform: rotateX(0deg); }
     50% { transform: rotateX(90deg); }
     100% { transform: rotateX(0deg); }
   }

   .cell-flip {
     animation: cell-flip 500ms ease;
   }
   ```

Avoid: Breaking existing functionality - the grid should still work in helper mode if gameMode is false.
  </action>
  <verify>
    - npm run build succeeds
    - setRowColors correctly updates cell colors
    - In game mode, clicking cells does not cycle colors
    - Flip animation plays when colors are revealed
  </verify>
  <done>GuessGrid supports game mode with programmatic color setting and reveal animation</done>
</task>

<task type="auto">
  <name>Task 3: Implement game mode for normal and practice play</name>
  <files>src/main.ts, src/data/history.ts</files>
  <action>
Convert the app to game mode where it loads today's puzzle and auto-reveals colors:

1. Update `src/data/history.ts` to add getTodaysPuzzle():
   ```typescript
   export function getTodaysPuzzle(): HistoricalPuzzle | null {
     const today = new Date();
     const dateStr = today.toISOString().split('T')[0]; // YYYY-MM-DD
     return getPuzzleByDate(dateStr);
   }
   ```

2. Update main.ts initialization:
   ```typescript
   import { calculateLetterStatuses } from './logic/gameLogic';
   import { getTodaysPuzzle } from './data/history';

   // Game state
   let currentPuzzle: HistoricalPuzzle | null = null;
   let gameMode: boolean = true; // Default to game mode

   // On app start, load today's puzzle
   async function initializeGame(): Promise<void> {
     currentPuzzle = await getTodaysPuzzle();
     if (currentPuzzle) {
       guessGrid.setGameMode(true);
       // Optionally show puzzle number in header or indicator
     } else {
       // Fallback: no puzzle for today, maybe show message
       console.warn('No puzzle available for today');
     }
   }

   initializeGame();
   ```

3. Update onSubmit handler to auto-calculate colors:
   ```typescript
   guessGrid.onSubmit((row: number) => {
     if (gameEnded) return;

     const word = guessGrid.getCurrentWord();

     // Validate word is in dictionary
     if (!isValidWord(word)) {
       guessGrid.shakeRow(row);
       showGameMessage('Not in word list', 'error');
       return;
     }

     clearGameMessage();

     // In game mode, calculate and set colors automatically
     if (gameMode && currentPuzzle) {
       const colors = calculateLetterStatuses(word, currentPuzzle.answer);
       guessGrid.setRowColors(row, colors);
     }

     // Check for win (all green)
     if (isRowAllGreen(row)) {
       gameEnded = true;
       guessGrid.lockInput();
       const message = practiceMode
         ? `Correct! The answer was: ${currentPuzzle!.answer.toUpperCase()}`
         : 'Congratulations! You solved it!';
       showGameMessage(message, 'success');
       if (!practiceMode) {
         currentStats = recordGame(currentStats, true, row + 1);
         saveStats(currentStats);
       }
       return;
     }

     // Check for game over (row 5)
     if (row === 5) {
       gameEnded = true;
       guessGrid.lockInput();
       showGameMessage(`Game over! The answer was: ${currentPuzzle!.answer.toUpperCase()}`, 'info');
       if (!practiceMode) {
         currentStats = recordGame(currentStats, false, 6);
         saveStats(currentStats);
       }
       return;
     }

     // Advance to next row
     guessGrid.advanceToNextRow();

     // Update suggestions and keyboard based on feedback
     updateSuggestions();
   });
   ```

4. Update startPracticeMode to work with game mode:
   - Practice mode already sets currentPuzzle
   - Ensure guessGrid.setGameMode(true) is called
   - Colors auto-reveal just like normal mode

5. Update resetGame to reload today's puzzle:
   ```typescript
   function resetGame(): void {
     // ... existing reset logic

     // Reload today's puzzle for fresh game
     if (!practiceMode) {
       initializeGame();
     }
   }
   ```

6. Update header to show current puzzle info:
   - Display "Wordle #XXX" or date in a subtitle or indicator
   - For practice mode, already shows practice indicator

Avoid: Removing helper mode entirely - keep gameMode flag so it could be toggled in future if needed, but default to true.
  </action>
  <verify>
    - npm run build succeeds
    - App loads today's puzzle on start
    - Typing a guess and pressing Enter reveals colors automatically
    - Win/loss detection works correctly
    - Practice mode also auto-reveals colors
    - Stats update correctly (only for non-practice games)
    - Suggestions still filter based on revealed feedback
  </verify>
  <done>App functions as a playable Wordle game with auto-color reveal for both daily and practice puzzles</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds without errors
- [ ] Today's puzzle loads automatically on app start
- [ ] Entering a valid word reveals green/yellow/gray colors correctly
- [ ] Invalid words show "Not in word list" error and shake
- [ ] Win after guessing correctly shows success message
- [ ] Loss after 6 wrong guesses shows answer
- [ ] Practice mode works identically with historical puzzles
- [ ] Keyboard hints update based on auto-revealed colors (if Phase 10 complete)
- [ ] Suggestions filter based on revealed feedback
- [ ] Stats only update for non-practice games
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- App is a fully playable Wordle game
- Both normal mode (today's puzzle) and practice mode work correctly
- Color reveal animation looks polished
</success_criteria>

<output>
After completion, create `.planning/phases/11-game-mode/11-01-SUMMARY.md`
</output>
