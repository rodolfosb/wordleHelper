---
phase: 18-internationalization
plan: 02
type: execute
wave: 2
depends_on: ["18-01"]
files_modified: [src/data/words/pt/, src/data/words/index.ts]
autonomous: true
---

<objective>
Create Portuguese word lists for all lengths (4-10 letters).

Purpose: Enable Portuguese gameplay in Open Mode.
Output: Portuguese word lists in `src/data/words/pt/` for all supported lengths.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-internationalization/DISCOVERY.md
@.planning/phases/18-internationalization/18-01-SUMMARY.md

@src/data/words/index.ts
@src/data/words/en/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fetch and process Portuguese dictionary</name>
  <files>scripts/ (temporary)</files>
  <action>
1. Fetch the IME-USP Brazilian Portuguese dictionary:
   URL: https://www.ime.usp.br/~pf/dicios/br-utf8.txt

2. Process the dictionary to create word lists by length:
   - Filter for 4, 5, 6, 7, 8, 9, 10 letter words
   - Convert to lowercase
   - Remove duplicates
   - Sort alphabetically
   - Keep accented characters (UTF-8)

3. Create a simple Node script to generate the TypeScript files:
   ```javascript
   // scripts/generate-pt-words.js
   const https = require('https');
   const fs = require('fs');
   const path = require('path');

   const URL = 'https://www.ime.usp.br/~pf/dicios/br-utf8.txt';
   const OUTPUT_DIR = path.join(__dirname, '../src/data/words/pt');

   // Portuguese valid characters (including accents)
   const validChars = /^[a-záàâãéêíóôõúç]+$/;

   https.get(URL, (res) => {
     let data = '';
     res.on('data', chunk => data += chunk);
     res.on('end', () => {
       const words = data.split('\n')
         .map(w => w.trim().toLowerCase())
         .filter(w => validChars.test(w));

       // Group by length
       const byLength = {};
       for (let len = 4; len <= 10; len++) {
         byLength[len] = [...new Set(words.filter(w => w.length === len))].sort();
       }

       // Create output directory
       if (!fs.existsSync(OUTPUT_DIR)) {
         fs.mkdirSync(OUTPUT_DIR, { recursive: true });
       }

       // Generate TypeScript files for each length
       for (const [len, wordList] of Object.entries(byLength)) {
         const content = `/**
* Portuguese ${len}-letter word list
* Source: IME-USP (https://www.ime.usp.br/~pf/dicios/)
* License: CC BY
*/
export const WORD_LIST_PT_${len}: string[] = [
${wordList.map(w => `  "${w}",`).join('\n')}
];

export const WORD_SET_PT_${len}: Set<string> = new Set(WORD_LIST_PT_${len});
`;
         fs.writeFileSync(path.join(OUTPUT_DIR, `words${len}.ts`), content);
         console.log(`Created words${len}.ts with ${wordList.length} words`);
       }

       console.log('Done!');
     });
   });
   ```

4. Run the script: `node scripts/generate-pt-words.js`

5. Verify each file was created with reasonable word counts:
   - 4-letter: ~2,000-5,000 words
   - 5-letter: ~5,000-10,000 words
   - 6-letter: ~8,000-15,000 words
   - etc.
  </action>
  <verify>All Portuguese word files created in src/data/words/pt/</verify>
  <done>Portuguese word lists generated for lengths 4-10</done>
</task>

<task type="auto">
  <name>Task 2: Create Portuguese index file</name>
  <files>src/data/words/pt/index.ts</files>
  <action>
1. Create `src/data/words/pt/index.ts`:
   ```typescript
   /**
    * Portuguese word lists
    * Source: IME-USP Brazilian Portuguese Dictionary
    * https://www.ime.usp.br/~pf/dicios/
    * License: CC BY
    */

   // Export all word lists
   export { WORD_LIST_PT_4, WORD_SET_PT_4 } from './words4';
   export { WORD_LIST_PT_5, WORD_SET_PT_5 } from './words5';
   export { WORD_LIST_PT_6, WORD_SET_PT_6 } from './words6';
   export { WORD_LIST_PT_7, WORD_SET_PT_7 } from './words7';
   export { WORD_LIST_PT_8, WORD_SET_PT_8 } from './words8';
   export { WORD_LIST_PT_9, WORD_SET_PT_9 } from './words9';
   export { WORD_LIST_PT_10, WORD_SET_PT_10 } from './words10';

   import { WORD_LIST_PT_4, WORD_SET_PT_4 } from './words4';
   import { WORD_LIST_PT_5, WORD_SET_PT_5 } from './words5';
   import { WORD_LIST_PT_6, WORD_SET_PT_6 } from './words6';
   import { WORD_LIST_PT_7, WORD_SET_PT_7 } from './words7';
   import { WORD_LIST_PT_8, WORD_SET_PT_8 } from './words8';
   import { WORD_LIST_PT_9, WORD_SET_PT_9 } from './words9';
   import { WORD_LIST_PT_10, WORD_SET_PT_10 } from './words10';

   /**
    * Get Portuguese word list for a given length
    */
   export function getPortugueseWordList(length: number): string[] {
     switch (length) {
       case 4: return WORD_LIST_PT_4;
       case 5: return WORD_LIST_PT_5;
       case 6: return WORD_LIST_PT_6;
       case 7: return WORD_LIST_PT_7;
       case 8: return WORD_LIST_PT_8;
       case 9: return WORD_LIST_PT_9;
       case 10: return WORD_LIST_PT_10;
       default: return WORD_LIST_PT_5;
     }
   }

   /**
    * Get Portuguese word set for a given length (O(1) lookup)
    */
   export function getPortugueseWordSet(length: number): Set<string> {
     switch (length) {
       case 4: return WORD_SET_PT_4;
       case 5: return WORD_SET_PT_5;
       case 6: return WORD_SET_PT_6;
       case 7: return WORD_SET_PT_7;
       case 8: return WORD_SET_PT_8;
       case 9: return WORD_SET_PT_9;
       case 10: return WORD_SET_PT_10;
       default: return WORD_SET_PT_5;
     }
   }
   ```
  </action>
  <verify>tsc --noEmit passes for Portuguese files</verify>
  <done>Portuguese index with helper functions created</done>
</task>

<task type="auto">
  <name>Task 3: Update main words index for Portuguese</name>
  <files>src/data/words/index.ts</files>
  <action>
1. Update `src/data/words/index.ts` to include Portuguese:

   Add import:
   ```typescript
   import { getPortugueseWordList, getPortugueseWordSet } from './pt';
   ```

   Add re-export:
   ```typescript
   export * from './pt';
   ```

2. Update `getWordListForLanguageAndLength()`:
   ```typescript
   export function getWordListForLanguageAndLength(
     language: WordLanguage,
     length: number
   ): string[] {
     const cacheKey = `${language}-${length}`;

     if (filteredWordListCache.has(cacheKey)) {
       return filteredWordListCache.get(cacheKey)!;
     }

     let rawList: string[];

     if (language === 'pt') {
       rawList = getPortugueseWordList(length);
     } else {
       rawList = getEnglishWordList(length);
     }

     // Filter to ensure correct length and valid characters
     const validChars = language === 'pt' ? /^[a-záàâãéêíóôõúç]+$/ : /^[a-z]+$/;
     const filtered = rawList.filter(word =>
       word.length === length && validChars.test(word)
     );

     filteredWordListCache.set(cacheKey, filtered);
     return filtered;
   }
   ```

3. The `getWordSetForLanguageAndLength()` function should work automatically since it calls `getWordListForLanguageAndLength()`.
  </action>
  <verify>npm run build succeeds</verify>
  <done>Main index updated to include Portuguese word lists</done>
</task>

<task type="auto">
  <name>Task 4: Clean up generation script</name>
  <files>scripts/</files>
  <action>
1. Either:
   - Delete `scripts/generate-pt-words.js` if not needed for future updates
   - Or keep it for future word list regeneration, add to .gitignore if needed

2. Verify all files are properly tracked in git
  </action>
  <verify>No stray files, git status clean</verify>
  <done>Generation script handled appropriately</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `src/data/words/pt/` contains word lists for lengths 4-10
- [ ] Each Portuguese word list has reasonable word counts
- [ ] `getPortugueseWordList()` and `getPortugueseWordSet()` work
- [ ] `getWordListForLanguageAndLength('pt', 5)` returns Portuguese words
- [ ] Portuguese words include accented characters (á, é, ç, etc.)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Portuguese word lists available for all lengths
- Ready for keyboard accent support in 18-03
</success_criteria>

<output>
After completion, create `.planning/phases/18-internationalization/18-02-SUMMARY.md`
</output>
