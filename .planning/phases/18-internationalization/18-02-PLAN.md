---
phase: 18-internationalization
plan: 02
type: execute
wave: 2
depends_on: ["18-01"]
files_modified: [src/ui/SettingsModal.ts, src/main.ts, src/logic/filter.ts]
autonomous: false
---

<objective>
Add language selector to Settings and integrate Portuguese words into Open Mode gameplay.

Purpose: Enable users to play with Portuguese words in Open Mode.
Output: Working language selector, Open Mode uses selected language.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-internationalization/DISCOVERY.md
@.planning/phases/18-internationalization/18-01-SUMMARY.md

@src/ui/SettingsModal.ts
@src/main.ts
@src/logic/filter.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add language selector to SettingsModal</name>
  <files>src/ui/SettingsModal.ts</files>
  <action>
1. Add a new settings item for word language in createModal(), after NYT Mode:
   ```html
   <div class="settings-item">
     <div class="settings-label">
       <span class="settings-name">Word Language</span>
       <span class="settings-description" id="word-language-description">Language for Open Mode words</span>
     </div>
     <select id="setting-word-language" class="settings-select">
       <option value="en">English</option>
       <option value="pt">Português</option>
     </select>
   </div>
   ```

2. Update setupToggleHandlers() to handle language selection:
   ```typescript
   const wordLanguageSelect = this.modalElement.querySelector('#setting-word-language') as HTMLSelectElement;

   wordLanguageSelect?.addEventListener('change', () => {
     this.currentSettings.wordLanguage = wordLanguageSelect.value as 'en' | 'pt';
     // When Portuguese selected, force word length to 5 (only supported length)
     if (this.currentSettings.wordLanguage === 'pt') {
       this.currentSettings.wordLength = 5;
       // Update word length selector display
       const wordLengthSelect = this.modalElement?.querySelector('#setting-word-length') as HTMLSelectElement;
       if (wordLengthSelect) {
         wordLengthSelect.value = '5';
       }
     }
     this.updateWordLengthSelectorState();
     this.notifySettingsChange();
   });
   ```

3. Update updateWordLengthSelectorState() to disable word length when Portuguese selected:
   ```typescript
   private updateWordLengthSelectorState(): void {
     if (!this.modalElement) return;

     const wordLengthSelect = this.modalElement.querySelector('#setting-word-length') as HTMLSelectElement;
     const wordLengthDescription = this.modalElement.querySelector('#word-length-description') as HTMLSpanElement;
     const wordLanguageSelect = this.modalElement.querySelector('#setting-word-language') as HTMLSelectElement;
     const wordLanguageDescription = this.modalElement.querySelector('#word-language-description') as HTMLSpanElement;

     // Word length disabled if NYT Mode OR Portuguese language (PT only has 5-letter words)
     const disableWordLength = this.currentSettings.nytMode || this.currentSettings.wordLanguage === 'pt';

     if (wordLengthSelect) {
       wordLengthSelect.disabled = disableWordLength;
     }

     if (wordLengthDescription) {
       if (this.currentSettings.nytMode) {
         wordLengthDescription.textContent = 'NYT Mode uses 5 letters';
       } else if (this.currentSettings.wordLanguage === 'pt') {
         wordLengthDescription.textContent = 'Portuguese only supports 5 letters';
       } else {
         wordLengthDescription.textContent = 'Number of letters for Open Mode games';
       }
     }

     // Word language disabled if NYT Mode (always English)
     if (wordLanguageSelect) {
       wordLanguageSelect.disabled = this.currentSettings.nytMode;
     }

     if (wordLanguageDescription) {
       if (this.currentSettings.nytMode) {
         wordLanguageDescription.textContent = 'NYT Mode uses English words';
       } else {
         wordLanguageDescription.textContent = 'Language for Open Mode words';
       }
     }
   }
   ```

4. Update render() to set word language selector value and call updateWordLengthSelectorState():
   ```typescript
   const wordLanguageSelect = this.modalElement.querySelector('#setting-word-language') as HTMLSelectElement;
   if (wordLanguageSelect) {
     wordLanguageSelect.value = settings.wordLanguage;
   }
   ```
  </action>
  <verify>npm run build succeeds</verify>
  <done>Language selector in Settings with proper disable logic</done>
</task>

<task type="auto">
  <name>Task 2: Integrate language setting into Open Mode</name>
  <files>src/main.ts</files>
  <action>
1. Import new helpers:
   ```typescript
   import { WORD_LIST, getWordListForLength, getWordListForLanguageAndLength, getWordSetForLanguageAndLength } from './data/words';
   ```

2. Track previous language setting (like previousNytMode):
   ```typescript
   let previousWordLanguage: 'en' | 'pt' = 'en';
   ```

3. Update applySettings() to handle language changes:
   ```typescript
   // Apply word language change in Open Mode (but not on initial load)
   if (!isInitial && !settings.nytMode && settings.wordLanguage !== previousWordLanguage) {
     previousWordLanguage = settings.wordLanguage;
     // When switching to Portuguese, ensure word length is 5
     if (settings.wordLanguage === 'pt' && settings.wordLength !== 5) {
       settings.wordLength = 5;
       currentWordLength = 5;
     }
     // Exit practice mode if active
     if (practiceMode) {
       practiceMode = false;
       practiceIndicator.classList.add('hidden');
     }
     // Reset and reinitialize with new language
     resetGame();
   }
   previousWordLanguage = settings.wordLanguage;
   ```

4. Update initializeGame() to use language-aware word list:
   ```typescript
   // Open mode: select random word based on word length and language settings
   const wordList = getWordListForLanguageAndLength(appSettings.wordLanguage, currentWordLength);
   openModeTarget = selectRandomWord(wordList);
   ```

5. Update updatePuzzleInfo() to show language:
   ```typescript
   if (!puzzle && !isNYTMode) {
     // Open Mode: show word length and language
     const langLabel = appSettings.wordLanguage === 'pt' ? 'Português' : 'English';
     puzzleInfo.textContent = `Open Mode (${wordLength} letters) - ${langLabel}`;
     puzzleInfo.classList.remove('stale-data-warning');
     return;
   }
   ```

6. Update resetGame() to use language setting when reinitializing:
   ```typescript
   // Reset suggestions to show full word list ranked for current word length and language
   const wordList = getWordListForLanguageAndLength(appSettings.wordLanguage, currentWordLength);
   filteredWords = wordList;
   const rankedWords = rankWords(wordList, wordList);
   suggestions.update(rankedWords, wordList.length);
   ```

7. Update updateSuggestions() to use language setting:
   ```typescript
   // Get the appropriate word list for current word length and language
   const wordList = getWordListForLanguageAndLength(appSettings.wordLanguage, currentWordLength);
   ```

8. Initialize previousWordLanguage from settings after loading:
   ```typescript
   previousWordLanguage = appSettings.wordLanguage;
   ```
  </action>
  <verify>npm run build succeeds</verify>
  <done>Open Mode uses language setting for word selection and display</done>
</task>

<task type="auto">
  <name>Task 3: Update word validation for Portuguese</name>
  <files>src/logic/filter.ts</files>
  <action>
1. Import language helpers:
   ```typescript
   import { getWordSetForLanguageAndLength, type WordLanguage } from '../data/words';
   ```

2. Update isValidWord() to accept language parameter:
   ```typescript
   /**
    * Check if a word is valid (exists in word list for given length and language)
    * @param word - The word to validate
    * @param length - The word length to check against (defaults to 5)
    * @param language - The word language to check against (defaults to 'en')
    * @returns True if word is valid
    */
   export function isValidWord(word: string, length: number = 5, language: WordLanguage = 'en'): boolean {
     const wordSet = getWordSetForLanguageAndLength(language, length);
     return wordSet.has(word.toLowerCase());
   }
   ```

3. Keep backward compatibility - if language not provided, defaults to 'en'
  </action>
  <verify>npm run build succeeds</verify>
  <done>Word validation supports Portuguese word list</done>
</task>

<task type="auto">
  <name>Task 4: Update main.ts to pass language to validation</name>
  <files>src/main.ts</files>
  <action>
Update the word validation call in guessGrid.onSubmit() callback:

```typescript
// Check if word is valid using the current word length and language
if (!isValidWord(word, currentWordLength, appSettings.wordLanguage)) {
  // Shake row and show message for invalid word, don't advance
  guessGrid.shakeRow(row);
  showGameMessage('Not in word list', 'error');
  return;
}
```
  </action>
  <verify>npm run build succeeds</verify>
  <done>Word validation uses language setting</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Portuguese word support in Open Mode with language selector</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Open Settings (gear icon)
    3. Turn OFF "NYT Mode" to enable Open Mode
    4. Verify: "Word Language" dropdown appears and is enabled
    5. Select "Português" from Word Language dropdown
    6. Verify: Word Length is forced to 5 and disabled
    7. Close Settings
    8. Verify: Puzzle info shows "Open Mode (5 letters) - Português"
    9. Try typing a Portuguese word like "TERMO" and submit
    10. Verify: Word is accepted and game plays correctly
    11. Try typing an English-only word like "CRANE"
    12. Verify: Word is rejected (shake animation, "Not in word list")
    13. Switch back to English in Settings
    14. Verify: "CRANE" is now accepted
    15. Verify: Word Length selector re-enables
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Language selector appears in Settings when NYT Mode is off
- [ ] Portuguese selection forces word length to 5
- [ ] Open Mode displays language in puzzle info
- [ ] Portuguese words are accepted when Portuguese selected
- [ ] English-only words rejected when Portuguese selected
- [ ] Language setting persists after page refresh
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Human verified Portuguese gameplay works correctly
- No errors or warnings introduced
</success_criteria>

<output>
After completion, create `.planning/phases/18-internationalization/18-02-SUMMARY.md`
</output>
